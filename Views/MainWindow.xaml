<!--
    MainWindow.xaml
    ================
    Main application window for yt-dlp p3k.local.

    Layout overview (3-row root Grid, centred, max-width 540):
      Row 0  – Branding header (app title + blurb)
      Row 1  – URL input bar (TextBox + GET button)
      Row 2  – Options panel (Format / Quality / File Type toggle rows)

    DataContext:
      Set to the MainWindow code-behind instance (DataContext = this) so that
      INotifyPropertyChanged properties such as QualityRowHeight can be bound
      directly in XAML without a separate ViewModel.

    Active-state pattern:
      Toggle buttons use Tag="active" / Tag="" to signal the selected item.
      The shared OptionButtonStyle reacts to Tag="active" by applying an
      accent-tinted fill (#1a2e24) and foreground (#4af0c0). Parent Border
      elements mirror the same state via DataTrigger so the border colour also
      updates without extra code-behind.
-->
<Window x:Class="yt_dlp_p3k_wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:yt_dlp_p3k_wpf"
        xmlns:sys="clr-namespace:System;assembly=System.Runtime"
        mc:Ignorable="d"
        Background="#0a0a0b"
        Title="yt-dlp.p3k.local" Height="700" Width="800">

    <Window.Resources>
        <!--
            OptionButtonStyle
            ─────────────────
            Shared style applied to every toggle button in the Format, Quality,
            and File Type rows. Three visual states are driven purely by triggers
            so no code-behind state management is required for appearance:

              Idle    – muted foreground (#6e6e7a), transparent background.
              Hover   – bright foreground (#e8e8ec), background unchanged.
              Active  – set Tag="active" on the Button to apply an accent fill
                        (#1a2e24 background, #4af0c0 foreground). The helper
                        SetActiveInGroup() in the code-behind manages the Tag
                        value; XAML triggers handle all rendering.
        -->
        <Style x:Key="OptionButtonStyle" TargetType="Button">
            <Setter Property="Background"            Value="Transparent" />
            <Setter Property="Foreground"            Value="#6e6e7a" />
            <Setter Property="FontFamily"            Value="{StaticResource Font.JetBrains}" />
            <Setter Property="FontSize"              Value="12.5" />
            <Setter Property="Padding"               Value="14,8" />
            <Setter Property="BorderThickness"       Value="0" />
            <Setter Property="VerticalAlignment"     Value="Stretch" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                Background="Transparent"
                                CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#e8e8ec" />
                            </Trigger>
                            <Trigger Property="Tag" Value="active">
                                <Setter TargetName="Root" Property="Background" Value="#1a2e24" />
                                <Setter Property="Foreground"                   Value="#4af0c0" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Url Warning Message Visibility bool-->
        <BooleanToVisibilityConverter x:Key="BoolToVis" />

    </Window.Resources>

    <!--
        Root layout Grid
        ────────────────
        Centred horizontally (HorizontalAlignment default) with a MaxWidth of
        540 px.  Three rows:
          Row 0 (Auto)  – Branding header: app title + blurb TextBlocks.
          Row 1 (Auto)  – URL input bar: TextBox with placeholder overlay and
                          the GET button that triggers a media-info fetch.
          Row 2 (*)     – Options panel: Format / Quality / File Type selectors
                          rendered inside a rounded Border card.
    -->
    <Grid VerticalAlignment="Center" MaxWidth="540">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" /><!-- header -->
             <RowDefinition Height="Auto" /><!-- input bar -->
             <RowDefinition Height="Auto" /><!-- options panel -->
             <RowDefinition Height="*" /><!-- log panel -->
        </Grid.RowDefinitions>

        <!--
            ══════════════════════════════════════════════
            Row 0 – Branding header
            ══════════════════════════════════════════════
            A vertical StackPanel containing:
              • App title – "yt-dlp" in accent green + ". p3k.local" in muted
                grey, both at 22 px using their respective custom FontFamily
                resources.
              • Blurb     – Short description with inline accent-coloured Runs
                highlighting key technology names (yt-dlp, ffmpeg, PHP).
        -->
        <StackPanel Orientation="Vertical"
                    VerticalAlignment="Center" Margin="10">

            <!-- App title -->
            <TextBlock Padding="10">

                <Run Text="yt-dlp"
                     FontFamily="{StaticResource Font.JetBrains}"
                     FontSize="22"
                     FontWeight="Bold"
                     Foreground="#4af0c0" />

                <Run Text=". p3k.local"
                     FontFamily="{StaticResource Font.Outfit}"
                     FontSize="22"
                     Foreground="#6e6e7a" />

            </TextBlock>

            <!-- Blurb -->
            <TextBlock Name="Blurb"
                       FontFamily="{StaticResource Font.Outfit}"
                       Foreground="#6e6e7a"
                       FontSize="12"
                       MaxWidth="540"
                       Padding="10,0"
                       TextWrapping="Wrap"
                       LineHeight="18"
                       LineStackingStrategy="BlockLineHeight">
                <Run Text="Download video and audio from YouTube and " />
                <Hyperlink NavigateUri="https://github.com/yt-dlp/yt-dlp/blob/master/supportedsites.md"
                           RequestNavigate="Hyperlink_RequestNavigate"
                           Foreground="#4af0c0" TextDecorations="None">thousands of other sites</Hyperlink>
                <Run Text=". Powered by" />
                <Hyperlink NavigateUri="https://github.com/yt-dlp/yt-dlp"
                           RequestNavigate="Hyperlink_RequestNavigate"
                           Foreground="#4af0c0" TextDecorations="None">yt-dlp</Hyperlink>
                <Run Text=", ffmpeg and PHP." />
            </TextBlock>

        </StackPanel>


        <!--
            ══════════════════════════════════════════════
            Row 1 – URL input bar
            ══════════════════════════════════════════════
            Two-column Grid:
              Column 0 (*) – URL TextBox inside a rounded Border. The Border's
                             BorderBrush transitions from #2a2a30 (idle) to
                             #4af0c0 (accent) when any child holds keyboard
                             focus (IsKeyboardFocusWithin trigger).
                             A placeholder TextBlock overlays the TextBox and
                             is hidden via DataTrigger when Input.Text is non-
                             empty, revealing only when the field is blank.
              Column 1 (80px) – GET button that fires a media-info fetch for
                             the URL typed in Column 0. Three visual states:
                             default (#4af0c0), hover (#D9 alpha), pressed
                             (full-opacity #4af0c0).
        -->
        <Grid Grid.Row="1" Margin="18,10">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" /><!-- URL input, takes remaining width -->
                <ColumnDefinition Width="80" /><!-- GET button, fixed width -->
            </Grid.ColumnDefinitions>
            <!--
                URL input container
                ───────────────────
                Rounded Border (CornerRadius=8) that acts as the visual shell
                for the TextBox. The BorderBrush is controlled by a Style
                trigger on IsKeyboardFocusWithin so the entire container
                highlights, not just the inner TextBox caret, giving a cleaner
                focused-field appearance.
            -->
            <Border  Grid.Column="0" CornerRadius="8"
                     BorderThickness="1"
                     Background="#131316">
                <Border.Style>
                    <Style TargetType="Border">

                        <!-- Idle state: subtle dark border -->
                        <Setter Property="BorderBrush"
                                Value="#2a2a30" />

                        <Style.Triggers>

                            <!-- Focused state: accent border when child has keyboard focus -->
                            <Trigger Property="IsKeyboardFocusWithin"
                                     Value="True">

                                <Setter Property="BorderBrush"
                                        Value="#4af0c0" />

                            </Trigger>

                        </Style.Triggers>

                    </Style>
                </Border.Style>
                <Grid>

                    <!--
                        Primary URL input field
                        ───────────────────────
                        Transparent background so the parent Border supplies
                        the rounded visual container. CaretBrush matches the
                        text foreground (#e8e8ec). BorderThickness=0 removes
                        the default WPF TextBox border.
                    -->
                    <TextBox x:Name="Input"
                             Background="Transparent"
                             Foreground="#e8e8ec"
                             FontFamily="{StaticResource Font.JetBrains}"
                             Padding="16,14"
                             BorderThickness="0"
                             CaretBrush="#e8e8ec" />

                    <!--
                        Placeholder overlay TextBlock
                        ────────────────────────────
                        Positioned over the TextBox via shared Grid cell.
                        IsHitTestVisible=False ensures mouse clicks pass through
                        to the TextBox beneath. Visibility is Collapsed by
                        default; a DataTrigger on Input.Text=="" makes it
                        Visible so it acts as a placeholder hint label.
                    -->
                    <TextBlock Text="Paste Youtube or other media url..."
                               Foreground="#6e6e7a"
                               FontFamily="{StaticResource Font.JetBrains}"
                               Margin="18,0,0,0"
                               VerticalAlignment="Center"
                               IsHitTestVisible="False">

                        <TextBlock.Style>
                            <Style TargetType="TextBlock">

                                <!-- Hidden while the TextBox contains text -->
                                <Setter Property="Visibility"
                                        Value="Collapsed" />

                                <Style.Triggers>

                                    <!-- Visible only when Input.Text is an empty string -->
                                    <DataTrigger Binding="{Binding Text, ElementName=Input}"
                                                 Value="">
                                        <Setter Property="Visibility"
                                                Value="Visible" />
                                    </DataTrigger>

                                </Style.Triggers>

                            </Style>
                        </TextBlock.Style>

                    </TextBlock>

                </Grid>

            </Border>


            <!-- Column 1 – GET button column -->
            <Grid Grid.Column="1">
                
                <!-- Rounded container for the GET button; background supplied by
                     the Button's own ControlTemplate so this Border stays transparent -->
                <Border CornerRadius="8"
                        BorderThickness="1"
                        Margin="10,0,0,0"
                        Background="Transparent">
                    <Grid>
                        <!--
                            GET button
                            ──────────
                            Fires DownloadButton_Click (code-behind) to begin
                            fetching metadata for the URL in the Input TextBox.
                            Uses a custom ControlTemplate to apply CornerRadius
                            and override the default WPF button chrome.
                        -->
                        <Button x:Name="Get"
                                BorderBrush="Transparent"
                                Padding="14"
                                VerticalAlignment="Stretch"
                                VerticalContentAlignment="Center"
                                FontFamily="{StaticResource Font.Outfit}"
                                FontWeight="Bold"
                                FontSize="14.4"
                                Content="GET" 
                                Click="OnClick_DownloadButton">

                            <Button.Style>
                                <Style TargetType="Button">

                                    <!-- default -->
                                    <Setter Property="Background"
                                            Value="#4af0c0" />

                                    <Setter Property="BorderThickness"
                                            Value="0" />

                                    <!-- remove default template -->
                                    <Setter Property="Template">

                                        <Setter.Value>

                                            <ControlTemplate TargetType="Button">

                                                <Border x:Name="Root"
                                                        Background="{TemplateBinding Background}"
                                                        CornerRadius="8">

                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                      VerticalAlignment="Center" />

                                                </Border>

                                                <ControlTemplate.Triggers>

                                                    <!-- Hover: accent colour at 85 % opacity (#D9 alpha) -->
                                                    <Trigger Property="IsMouseOver"
                                                             Value="True">

                                                        <Setter TargetName="Root"
                                                                Property="Background"
                                                                Value="#D94af0c0" />

                                                    </Trigger>

                                                    <!-- Enabled: accent colour at 35 % opacity (#D9 alpha) -->
                                                    <DataTrigger Binding="{Binding FoundRequiredBinaries}" Value="False">
                                                        <Setter TargetName="Root" Property="Background" Value="#29473f" />
                                                    </DataTrigger>

                                                    <!-- Pressed: full-opacity accent colour for click feedback -->
                                                    <Trigger Property="IsPressed"
                                                             Value="True">

                                                        <Setter TargetName="Root"
                                                                Property="Background"
                                                                Value="#FF4af0c0" />

                                                    </Trigger>

                                                </ControlTemplate.Triggers>

                                            </ControlTemplate>

                                        </Setter.Value>

                                    </Setter>

                                </Style>
                            </Button.Style>

                        </Button>

                    </Grid>

                </Border>
            </Grid>
            
            <Label Grid.Column="0" Margin="0" Padding="0" Foreground="DarkRed"
                   VerticalAlignment="Top"
                   Visibility="{Binding UrlWarningVis, Converter={StaticResource BoolToVis}}"
                   Content="{Binding UrlWarningText}">
                <Label.RenderTransform>
                    <TranslateTransform Y="-18" />
                </Label.RenderTransform>
            </Label>

        </Grid>

        <!--
            ══════════════════════════════════════════════
            Row 2 – Options panel
            ══════════════════════════════════════════════
            Rounded Border card containing a 3-row inner Grid:

              Row 0 (70 px)           – Format selector (Video+Audio / Video
                                        Only / Audio Only). FormatButton_Click
                                        in code-behind calls SetActiveInGroup()
                                        and toggles QualityRowHeight / file-type
                                        grid visibility accordingly.

              Row 1 (QualityRowHeight) – Quality selector (Best / 1080p / 720p /
                                        480p). Height is data-bound to the
                                        QualityRowHeight property (INotifyPropertyChanged)
                                        on the MainWindow. Set to 0 when Audio
                                        Only is selected (quality is irrelevant
                                        for audio-only downloads).

              Row 2 (70 px)           – File Type selector. Two overlapping
                                        Grids occupy this row:
                                          • VideoFileTypes – mp4 / mkv / webm
                                            (shown for Video+Audio and Video Only).
                                          • AudioFileTypes – mp3 / m4a / ogg
                                            (shown for Audio Only, hidden by
                                            default via Visibility="Hidden").
                                        The code-behind swaps visibility when
                                        the Format selection changes.
        -->
        <Grid Grid.Row="2" Margin="18,10" VerticalAlignment="Top">


            <Border CornerRadius="10"
                    Background="#131316"
                    BorderThickness="1"
                    BorderBrush="#2a2a30"
                    Padding="10">

                <Grid>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="70" />
                        <!-- QualityRowHeight is an INotifyPropertyChanged property on the
                             MainWindow code-behind. It is set to 70 (visible) for Video+Audio
                             and Video Only formats, and collapsed to 0 for Audio Only because
                             quality resolution is not applicable to audio-only downloads. -->
                        <RowDefinition Height="{Binding QualityRowHeight}" />
                        <RowDefinition Height="70" />
                    </Grid.RowDefinitions>

                    <!-- Format row: Video+Audio / Video Only / Audio Only.
                         Click handler: FormatButton_Click – updates the active tag,
                         adjusts QualityRowHeight, and swaps VideoFileTypes /
                         AudioFileTypes visibility. -->
                    <Grid x:Name="Formats" Margin="0,0,0,10">

                        <Grid.RowDefinitions>
                            <RowDefinition Height="24" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Label FontSize="11.2" FontWeight="Bold" Foreground="#6e6e7a">FORMAT</Label>

                        <Grid Grid.Row="1" >

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <Border CornerRadius="6" 
                                    BorderThickness="1"
                                    Margin="3,0"
                                    Background="Transparent">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderBrush" Value="#2a2a30" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </Trigger>
                                            <DataTrigger Binding="{Binding Tag, ElementName=Vid_Aud}" Value="active">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Button x:Name="Vid_Aud"
                                        Style="{StaticResource OptionButtonStyle}"
                                        Content="Video + Audio"
                                        Click="OnClick_FormatButton" />

                            </Border>
                           
                            <Border Grid.Column="1" CornerRadius="6"
                                    BorderThickness="1"
                                    Margin="3,0"
                                    Background="Transparent">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderBrush" Value="#2a2a30" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </Trigger>
                                            <DataTrigger Binding="{Binding Tag, ElementName=Vid}" Value="active">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Button x:Name="Vid"
                                        Style="{StaticResource OptionButtonStyle}"
                                        Content="Video Only"
                                        Click="OnClick_FormatButton" />
                            </Border>

                            <Border Grid.Column="2" CornerRadius="6"
                                    BorderThickness="1"
                                    Margin="3,0"
                                    Background="Transparent">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderBrush" Value="#2a2a30" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </Trigger>
                                            <DataTrigger Binding="{Binding Tag, ElementName=Aud}" Value="active">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Button x:Name="Aud" 
                                        Style="{StaticResource OptionButtonStyle}"
                                        Content="Audio Only"
                                        Click="OnClick_FormatButton" />
                            </Border>


                        </Grid>
                    </Grid>


                    <!-- Quality row: Best / 1080p / 720p / 480p.
                         Click handler: QualityButton_Click.
                         Hidden (row height = 0) when Audio Only is the active format. -->
                    <Grid Grid.Row="1" x:Name="Quality" Margin="0,0,0,10">

                        <Grid.RowDefinitions>
                            <RowDefinition Height="24" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Label FontSize="11.2" FontWeight="Bold" Foreground="#6e6e7a">QUALITY</Label>

                        <Grid Grid.Row="1">

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" CornerRadius="6"
                                    BorderThickness="1"
                                    Margin="3,0"
                                    Background="Transparent">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderBrush" Value="#2a2a30" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </Trigger>
                                            <DataTrigger Binding="{Binding Tag, ElementName=QBest}" Value="active">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Button x:Name="QBest"
                                        Style="{StaticResource OptionButtonStyle}"
                                        Content="Best"
                                        Click="OnClick_QualityButton" />
                            </Border>

                            <Border Grid.Column="1" CornerRadius="6"
                                    BorderThickness="1"
                                    Margin="3,0"
                                    Background="Transparent">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderBrush" Value="#2a2a30" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </Trigger>
                                            <DataTrigger Binding="{Binding Tag, ElementName=Q1080p}" Value="active">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Button x:Name="Q1080p"
                                        Style="{StaticResource OptionButtonStyle}"
                                        Content="1080p"
                                        Click="OnClick_QualityButton" />
                            </Border>

                            <Border Grid.Column="2" CornerRadius="6"
                                    BorderThickness="1"
                                    Margin="3,0"
                                    Background="Transparent">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderBrush" Value="#2a2a30" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </Trigger>
                                            <DataTrigger Binding="{Binding Tag, ElementName=Q720p}" Value="active">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Button x:Name="Q720p"
                                        Style="{StaticResource OptionButtonStyle}"
                                        Content="720p"
                                        Click="OnClick_QualityButton" />
                            </Border>

                            <Border Grid.Column="3" CornerRadius="6"
                                    BorderThickness="1"
                                    Margin="3,0"
                                    Background="Transparent">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderBrush" Value="#2a2a30" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </Trigger>
                                            <DataTrigger Binding="{Binding Tag, ElementName=Q480}" Value="active">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Button x:Name="Q480"
                                        Style="{StaticResource OptionButtonStyle}"
                                        Content="480p"
                                        Click="OnClick_QualityButton" />
                            </Border>

                        </Grid>
                    </Grid>


                    <!-- VideoFileTypes: mp4 / mkv / webm.
                         Visible by default (shown for Video+Audio and Video Only).
                         Click handler: VideoFileTypeButton_Click. -->
                    <Grid Grid.Row="2" x:Name="VideoFileTypes" Margin="0,0,0,10">

                        <Grid.RowDefinitions>
                            <RowDefinition Height="24" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Label FontSize="11.2" FontWeight="Bold" Foreground="#6e6e7a">FILE TYPE</Label>

                        <Grid Grid.Row="1">

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" CornerRadius="6"
                                    BorderThickness="1"
                                    Margin="3,0"
                                    Background="Transparent">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderBrush" Value="#2a2a30" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </Trigger>
                                            <DataTrigger Binding="{Binding Tag, ElementName=mp4}" Value="active">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Button x:Name="mp4"
                                        Style="{StaticResource OptionButtonStyle}"
                                        Content="mp4"
                                        Click="OnClick_VideoFileTypeButton" />
                            </Border>

                            <Border Grid.Column="1" CornerRadius="6"
                                    BorderThickness="1"
                                    Margin="3,0"
                                    Background="Transparent">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderBrush" Value="#2a2a30" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </Trigger>
                                            <DataTrigger Binding="{Binding Tag, ElementName=mkv}" Value="active">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Button x:Name="mkv"
                                        Style="{StaticResource OptionButtonStyle}"
                                        Content="mkv"
                                        Click="OnClick_VideoFileTypeButton" />
                            </Border>

                            <Border Grid.Column="2" CornerRadius="6"
                                    BorderThickness="1"
                                    Margin="3,0"
                                    Background="Transparent">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderBrush" Value="#2a2a30" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </Trigger>
                                            <DataTrigger Binding="{Binding Tag, ElementName=webm}" Value="active">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Button x:Name="webm"
                                        Style="{StaticResource OptionButtonStyle}"
                                        Content="webm"
                                        Click="OnClick_VideoFileTypeButton" />
                            </Border>


                        </Grid>
                    </Grid>

                    <!-- AudioFileTypes: mp3 / m4a / ogg.
                         Hidden by default (Visibility="Hidden" preserves layout space).
                         Swapped in by code-behind when Audio Only format is active.
                         Click handler: AudioFileTypeButton_Click. -->
                    <Grid Grid.Row="2" x:Name="AudioFileTypes" Visibility="Hidden">

                        <Grid.RowDefinitions>
                            <RowDefinition Height="24" />
                            <RowDefinition Height="36" />
                        </Grid.RowDefinitions>

                        <Label FontSize="11.2" FontWeight="Bold" Foreground="#6e6e7a">FILE TYPE</Label>

                        <Grid Grid.Row="1">

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" CornerRadius="6"
                                    BorderThickness="1"
                                    Margin="3,0"
                                    Background="Transparent">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderBrush" Value="#2a2a30" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </Trigger>
                                            <DataTrigger Binding="{Binding Tag, ElementName=mp3}" Value="active">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Button x:Name="mp3"
                                        Style="{StaticResource OptionButtonStyle}"
                                        Content="mp3"
                                        Click="OnClick_AudioFileTypeButton" />
                            </Border>

                            <Border Grid.Column="1" CornerRadius="6"
                                    BorderThickness="1"
                                    Margin="3,0"
                                    Background="Transparent">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderBrush" Value="#2a2a30" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </Trigger>
                                            <DataTrigger Binding="{Binding Tag, ElementName=m4a}" Value="active">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Button x:Name="m4a"
                                        Style="{StaticResource OptionButtonStyle}"
                                        Content="m4a"
                                        Click="OnClick_AudioFileTypeButton" />
                            </Border>

                            <Border Grid.Column="2" CornerRadius="6"
                                    BorderThickness="1"
                                    Margin="3,0"
                                    Background="Transparent">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderBrush" Value="#2a2a30" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </Trigger>
                                            <DataTrigger Binding="{Binding Tag, ElementName=ogg}" Value="active">
                                                <Setter Property="BorderBrush" Value="#4af0c0" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Button x:Name="ogg"
                                        Style="{StaticResource OptionButtonStyle}"
                                        Content="ogg"
                                        Click="OnClick_AudioFileTypeButton" />
                            </Border>


                        </Grid>
                    </Grid>


                </Grid>

            </Border>

        </Grid>

        <!--
            ══════════════════════════════════════════════
            Row 3 – Status + progress bar + log box
            ══════════════════════════════════════════════
            Mirrors the PHP front-end layout:
              • Status text  – phase label (starting / downloading / merging / done)
              • Progress bar – thin 4 px horizontal bar
              • Log box      – scrollable monospace output from yt-dlp

            The entire section appears once a download starts and remains
            visible after completion so the user can see the final state.
        -->
        <StackPanel Grid.Row="3" Margin="18,0,18,10"
                    Visibility="{Binding LogPanelVis, Converter={StaticResource BoolToVis}}">

            <!-- Status text -->
            <TextBlock Text="{Binding StatusText}"
                       FontFamily="{StaticResource Font.JetBrains}"
                       FontSize="11"
                       TextWrapping="Wrap"
                       Margin="0,0,0,6">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Foreground" Value="#6e6e7a" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding StatusStyle}" Value="success">
                                <Setter Property="Foreground" Value="#4af0c0" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding StatusStyle}" Value="error">
                                <Setter Property="Foreground" Value="#e05252" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>

            <!-- Thin progress bar (4 px, matches .progress-bar / .progress-fill) -->
            <Border CornerRadius="2"
                    Background="#1a1a1f"
                    Height="4"
                    Margin="0,0,0,14">
                <Border CornerRadius="2"
                        Background="#4af0c0"
                        RenderTransformOrigin="0,0.5">
                    <Border.RenderTransform>
                        <ScaleTransform x:Name="ProgressScale" ScaleX="0" />
                    </Border.RenderTransform>
                </Border>
            </Border>

            <!-- Log box (matches .log-box) -->
            <Border CornerRadius="8"
                    Background="#131316"
                    BorderThickness="1"
                    BorderBrush="#2a2a30"
                    Padding="12,10">

                <ScrollViewer x:Name="LogScrollViewer"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              MaxHeight="180"
                              Background="Transparent">

                    <ItemsControl ItemsSource="{Binding LogMessages}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}"
                                           Foreground="#6e6e7a"
                                           FontFamily="{StaticResource Font.JetBrains}"
                                           FontSize="10"
                                           TextWrapping="Wrap"
                                           LineHeight="15"
                                           Margin="0,0,0,1" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                </ScrollViewer>

            </Border>

        </StackPanel>

    </Grid>
</Window>